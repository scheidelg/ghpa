<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/localstyle.css">

        <!-- Load the GHPA functions and initial configuration. -->
        <script src="/js/GHPA.js"></script>

        <script>
            // Quick function to make an element 'flash'
            async function flashElement(elementReference) {

                let flashCount;
                // number of milliseconds to display the new style on each
                // 'flash'
                const secondsNewStyle = 900
                // number of milliseconds to display the old style between
                // each 'flash'
                const secondsOldStyle = 300

                // save the current style information
                const oldStyle=elementReference.style

                // set the style to use to 'flash' the content; this should
                // match the style used inside the loop
                elementReference.style.color = 'blue';

                // set 'flashCount < 5' to the number of times you want to
                // flip between styles
                for (flashCount = 0; flashCount < 5; flashCount++) {

                    // after the desired interval, revert to the original style
                    setTimeout(function(){ elementReference.style = oldStyle; }, ((flashCount * (secondsNewStyle + secondsOldStyle)) + secondsNewStyle));

                    // after the desired interval, change to the new style
                    setTimeout(function(){ elementReference.style.color = 'blue'; }, ((flashCount * (secondsNewStyle + secondsOldStyle)) + (secondsNewStyle + secondsOldStyle)));

                }

                // final reversion to the original style
                setTimeout(function(){ elementReference.style = oldStyle; }, ((flashCount * (secondsNewStyle + secondsOldStyle)) + secondsNewStyle));

                // return 'true' so a calling event still takes its default
                // action
                return (true);
            }

            // Quick function to display a variable's value as text, or an
            // appropriate string if the variable is undefined or empty.
            function displayVarVal(myVariable, truthyText, falsyText) {
                const variableType = typeof myVariable;
                let retval;

                // if the variable is undefined, just return 'undefined'
                if (variableType == 'undefined') {
                    retval = '(undefined)';

                // variable is defined and truthy
                } else if (myVariable) {
                    // if we were passed truthyText then use that; otherwise
                    // use the variable's value
                    retval = (typeof truthyText == 'undefined' ? String(myVariable): truthyText);

                // variable is defined and falsy
                } else {

                    // if we were passed falsyTest then use that
                    if (typeof falsyText != 'undefined') {
                        retval = falsyText

                    // OK, now we have to check the variable type and provide
                    // appropriate falsy text
                    } else {
                        switch(variableType) {
                            case 'boolean':
                            case 'number':
                            case 'bigint':
                                retval = String(myVariable);
                                break;
                            default:
                                retval = '(empty ${variableType})';
                        }
                    }
                }

                return (retval);
            }
        </script>
    </head>
    <body>
        <noscript><p>
            GHPA requires client-side JavaScript to be enabled. Please enable JavaScript and reload the page.
        <p></noscript>

        <h1>GitHub Pages Authentication (GHPA)</h1>
        
        <p>GitHub Pages Authentication (GHPA) allows a GitHub Pages website to be used as a secure front-end for content stored in a private GitHub repository. This website demonstrates using GHPA.<p>
        
        <p>For details on GHPA, see <a href="https://github.com/scheidelg/ghpa">https://github.com/scheidelg/ghpa</a>.</p>

        <hr>

        <table>
            <tr>
                <th colspan="8" style="font-style: italic;">The listed pages demonstrate some (but not all) of the ways to use GHPA to access content in the private GitHub repository.</th>
            <tr>
            <tr>
                <th>Description</a></th>
                <th>Public File</a></th>
                <th><a href="#ghpaRepo" onclick="flashElement(document.getElementById('ghpaRepo'));">Private Repo</a></th>
                <th><a href="#ghpaFilename" onclick="flashElement(document.getElementById('ghpaFilename'));">Private File</a></th>
                <th><a href="#ghpaLoginFormFile" onclick="flashElement(document.getElementById('ghpaLoginFormFile'));">Login Form</a></th>
                <th><a href="#ghpaSSOFlag" onclick="flashElement(document.getElementById('ghpaSSOFlag'));">SSO?</a></th>
                <th><a href="#ghpaAuthOnlyFlag" onclick="flashElement(document.getElementById('ghpaAuthOnlyFlag'));">Auth Only?</a></th>
                <th><a href="#ghpaRenderRetrievedBodyOnlyFlag" onclick="flashElement(document.getElementById('ghpaRenderRetrievedBodyOnlyFlag'));">Retrieve Only &lt;body&gt;?</a></th>
            </tr>
            <tr>
                <td><a href="examples/file1.html">Public stub file, corresponding private file</a>
                    <p>The stub file exists in the public repository and a corresponding private file exists in the private repository.</p>
                </td>
                <td>file1.html</td>
                <td>(global)</td>
                <td>(default)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/file2.html">Public stub file, corresponding private file, no SSO</a>
                    <p>The stub file exists in the private repository and a corresponding private file exists in the private repository. However, the public stub file explicitly includes a flag to <b>not</b> use or cache credentials.</p>
                </td>
                <td>file2.html</td>
                <td>(global)</td>
                <td>(default)</td>
                <td>(global)</td>
                <td>N</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/file3.html">Public stub file, corresponding private file, different login form</a>
                    <p>The stub file exists in the public repository and a corresponding private file exists in the private repository. This example uses a different login form.</p>
                </td>
                <td>file3.html</td>
                <td>(global)</td>
                <td>(default)</td>
                <td>loginform-right.html</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/explicit.html">Public stub file, different private file via absolute path</a>
                    <p>The stub file exists in the public repository but explicitly identifies a different file to load from the private repository. The file is identified with an absolute path.</p></td>
                <td>explicit.html</td>
                <td>(global)</td>
                <td>/examples/file4.html</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/file5.html">Public stub file, different private file via relative path</a>
                    <p>The stub file exists in the public repository but explicitly identifies a different file to load from the private repository. The file is identified with a relative path.</p></td>
                <td>file5.html</td>
                <td>(global)</td>
                <td>sub/file5.html</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/no_file.html">Public stub file, no corresponding private file</a>
                    <p>The stub file exists in the public repository but there's no corresponding file in the private repository.</p>
                </td>
                <td>no_file.html</td>
                <td>(global)</td>
                <td>(none)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/file4.html">Public stub file, different private repository</a>
                    <p>The stub file exists in the public repository but explicitly identifies a different private repository to load the private file from.</p></td>
                <td>file4.html</td>
                <td>ghpa-private-2</td>
                <td>(default)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/file1_repo2.html">Public stub file, different private repository, different file in same directory</a>
                    <p>The stub file exists in the public repository but explicitly identifies a different private repository from which to load a different private file. The file is identified only by it's filename, meaning that the file will be retrieved from the same relative directory as the public stub file.</p></td>
                <td>file1_repo2.html</td>
                <td>ghpa-private-2</td>
                <td>file1.html</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/login.html">Login to GitHub</a>
                    <p>Access the login page to authenticate to GitHub and cache credentials, without actually loading a private file. This is useful only to establish authentication for SSO.</p>
                </td>
                <td>login.html</td>
                <td>(global)</td>
                <td>(none)</td>
                <td>(global)</td>
                <td>(global)</td>
                <td>Y</td>
                <td>(global)</td>
            </tr>
            <tr>
                <td><a href="examples/logout.html">Logout of the private repository</a>
                    <p>Clear cached credentials so the user has to authenticate again to access content from the private repository.</p>
                </td>
                <td>logout.html</td>
                <td>(global, n/a)</td>
                <td>(none)</td>
                <td>(global, n/a)</td>
                <td>(global, n/a)</td>
                <td>(global, n/a)</td>
                <td>(global, n/a)</td>
            </tr>
        </table>

        <table>
            <tr>
                <th colspan="4" style="font-style: italic;">These are the currently configured global GHPA configuration options and variables.</th>
            </tr>
            <tr>
                <th>Description</th>
                <th>Variable</th>
                <th>Value</th>
                <th>Page Can Override?</th>
            </tr>
            <tr>
                <td>Current GitHub and GHPA SSO user ID</td>
                <td>ghpaUserID</td>
                <td><script>document.write(htmlEncode(typeof ghpaUserID === '(undefined)' ? 'undefined' : (ghpaUserID ? ghpaUserID : '(not currently logged in)')))</script></td>
                <td>Y</td>
            </tr>
            <tr>
                <td>GitHub Organization
                    <p>The GitHub organization that will be used unless overridden on a specific web page.</p>
                </td>
                <td>ghpaOrg</td>
                <td><script>document.write(htmlEncode(typeof ghpaOrg === '(undefined)' ? 'undefined' : (ghpaOrg ? ghpaOrg : '(empty)')))</script></td>
                <td>Y</td>
            </tr>
            <tr id='ghpaRepo'>
                <td>GitHub Repository
                    <p>The GitHub repository that will be used unless overridden on a specific web page.</p>
                </td>
                <td>ghpaRepo</td>
                <td><script>document.write(htmlEncode(typeof ghpaRepo === '(undefined)' ? 'undefined' : (ghpaRepo ? ghpaRepo : '(empty)')))</script></td>
                <td>Y</td>
            </tr>
            <tr>
                <td>GitHub Branch
                    <p>The GitHub branch that will be used unless overridden on a specific web page.</p>
                </td>
                <td>ghpaBranch</td>
                <td><script>document.write(htmlEncode(typeof ghpaBranch === '(undefined)' ? 'undefined' : (ghpaBranch ? ghpaBranch : '(empty)')))</script></td>
                <td>Y</td>
            </tr>
            <tr>
                <td>Default HTML File
                    <p>The HTML file to retrieve from the private GitHub repository if the browsing a GitHub Pages directory.</p>
                </td>
                <td>ghpaDefaultHTMLfile</td>
                <td><script>document.write(htmlEncode(typeof ghpaDefaultHTMLfile === '(undefined)' ? 'undefined' : (ghpaDefaultHTMLfile ? ghpaDefaultHTMLfile : '(empty)')))</script></td>
                <td>Y</td>
            </tr>
            <tr id='ghpaLoginFormFile'>
                <td>Login File
                    <p>The HTML file to load as the login form when the user needs to authenticate to GitHub.<br></p>
                </td>
                <td>ghpaLoginFormFile</td>
                <td><script>document.write(htmlEncode(typeof ghpaLoginFormFile === '(undefined)' ? 'undefined' : (ghpaLoginFormFile ? ghpaLoginFormFile : '(empty)')))</script></td>
                <td>Y</td>
            </tr>
            <tr id='ghpaFilename'>
                <td>File to Retrieve 
                    <p>The name of the file to retrieve from the private GitHub repository. This should always be empty in the global configuration.</p>
                </td>
                <td>ghpaFilename</td>
                <td><script>document.write(htmlEncode(typeof ghpaFilename === '(undefined)' ? 'undefined' : (ghpaFilename ? ghpaFilename : '(empty)')))</script></td>
                <td>Y</td>
            </tr>
            <tr>
                <td>Flag: GitHub Tokens Only
                    <p>Should the password be required to match the format of a GitHub personal access token string?</p>
                </td>
                <td>ghpaTokensOnlyFlag</td>
                <td><script>document.write(htmlEncode(typeof ghpaTokensOnlyFlag === '(undefined)' ? 'undefined' : (ghpaTokensOnlyFlag ? '(true)': '(false)')))</script></td>
                <td>N</td>
            </tr>
            <tr id='ghpaSSOFlag'>
                <td>Flag: Single Sign-on (SSO)
                    <p>Should successful authentication cause GitHub credentials to be remembered and used for later authentication (so that the user doesn't have to continually re-enter the credentials)?</p>
                </td>
                <td>ghpaSSOFlag</td>
                <td><script>document.write(htmlEncode(typeof ghpaSSOFlag === '(undefined)' ? 'undefined' : (ghpaSSOFlag ? '(true)' : '(false)')))</script></td>
                <td>Y</td>
            </tr>
            <tr id='ghpaAuthOnlyFlag'>
                <td>Flag: Authentication Only
                    <p>Should a public stub file should only perform a GitHub authentication check (e.g., authentication-only) vs. loading a page from the private GitHub repository?</p>
                </td>
                <td>ghpaAuthOnlyFlag</td>
                <td><script>document.write(htmlEncode(typeof ghpaAuthOnlyFlag === '(undefined)' ? 'undefined' : (ghpaAuthOnlyFlag ? '(true)' : '(false)')))</script></td>
                <td>Y</td>
            </tr>
            <tr id='ghpaRenderRetrievedBodyOnlyFlag'>
                <td>Flag: Only Render Retreived Body
                    <p>After retrieving content from a private GitHub repository file, should we check the retrieved content for &lt;body&gt;&lt;/body&gt; tags and only render that content, vs. rendering all the retrieved content?</p>
                </td>
                <td>ghpaRenderRetrievedBodyOnlyFlag</td>
<!--                <td><script>document.write(htmlEncode(typeof ghpaRenderRetrievedBodyOnlyFlag === '(undefined)' ? 'undefined' : (ghpaRenderRetrievedBodyOnlyFlag ? '(true)' : '(false)')))</script></td> -->
                <td><script>document.write(htmlEncode(displayVarVal(ghpaRenderRetrievedBodyOnlyFlag)));</script></td>
                <td>Y</td>
            </tr>
        <table>
    </body>
</html>
